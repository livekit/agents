
services:
  toxiproxy:
    build:
      context: ..
      dockerfile: tests/Dockerfile.toxiproxy
    container_name: toxiproxy
    command: ["toxiproxy-server", "-host", "0.0.0.0", "-port", "8474"]
    environment:
      - LOG_LEVEL=info
    ports:
      - "8474:8474"
      - "443:443"
    networks:
      toxinet:
        ipv4_address: 172.28.0.2

  app:
    build:
      context: ..
      dockerfile: tests/Dockerfile.tests
    container_name: app
    volumes:
      - ../tests:/app/tests
      - ../livekit-agents:/app/livekit-agents
      - ../livekit-plugins:/app/livekit-plugins
      - ../pyproject.toml:/app/pyproject.toml
    env_file:
      - ../.env
    extra_hosts:
    # TTSs
      - "api.cartesia.ai:172.28.0.2"
      - "polly.us-west-2.amazonaws.com:172.28.0.2"

    networks:
      - toxinet

networks:
  toxinet:
    driver: bridge
    ipam:
      config:
        - subnet: "172.28.0.0/16"